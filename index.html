<html>

<head>
    <title>Portfoli-O-Meter</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=PT+Sans+Narrow&display=swap"
        rel="stylesheet">
</head>

<body>

    <div class="banner">
        <h1 class="logo">Portfoli-O-Meter</h1>
        <h2 class="logo2">Enhance Your Portfolio like a Pro!</h2>
        <div class="container">
            <div class="box1">
                <h2 class="logo3">Upload your Resume here to get it graded!</h2>
                <h3 class="logo3">------------------------------------ </h3>
                <input type="file" id="fileInput" />
            </div>
            <div class="container2">
                <div class="box2">
                    <h2 class="logo4">Your results will load here!</h2>
                    <h3 class="logo3">--------------------------------------------------------------------------- </h3>
                    <p id="result"></p>
                </div>
                <div class="container3">
                    <div class="box3">
                        <h2 class="logo5">Made By: </h2>
                        <h3 class="logo6">Omar Abouzied</h3>
                        <h3 class="logo7">Youssef Abouzied</h3>
                        <h3 class="logo8">Anudev Gill</h3>
                        <h3 class="logo9">Saad Koker</h3>
                    </div>
                </div>
            </div>
            <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
            <script>
                const openaiApiKey = 'sk-';

                async function parsePdf(dataBuffer) {
                    const pdfjsLib = window['pdfjs-dist/build/pdf'];
                    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://mozilla.github.io/pdf.js/build/pdf.worker.js';
                    const pdf = await pdfjsLib.getDocument({ data: dataBuffer }).promise;
                    let pdfText = '';
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const text = textContent.items.map(item => item.str).join(' ');
                        pdfText += text + '\n';
                    }
                    return pdfText;
                }

                async function generateResponse(prompt) {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${openaiApiKey}`
                        },
                        body: JSON.stringify({
                            model: "gpt-3.5-turbo",
                            messages: prompt,
                        })
                    });
                    const data = await response.json();
                    return data.choices[0].message.content;
                }

                document.getElementById('fileInput').addEventListener('change', async (event) => {
                    const file = event.target.files[0];
                    const reader = new FileReader();
                    reader.onload = async (event) => {
                        const dataBuffer = event.target.result;
                        const pdfText = await parsePdf(dataBuffer);
                        console.log(pdfText);

                        const message = `Pretend you are a Google recruiter and provide constructive criticism to the following resume: ${pdfText}`;
                        console.log(message)
                        const prompt = [
                            { role: "user", content: message },
                        ];
                        const response = await generateResponse(prompt);
                        document.getElementById("result").textContent += response;
                    };
                    reader.readAsArrayBuffer(file);
                });
            </script>
</body>

</html>
